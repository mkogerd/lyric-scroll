<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="stylesheet.css">
	</head>
	<body>
		<textarea id='textarea_id'>
Hallelujah
Leonard Cohen

Now, I've heard there was a secret chord
That David played, and it pleased the Lord
But you don't really care for music, do you?
It goes like this, the fourth, the fifth
The minor fall, the major lift
The baffled king composing hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Your faith was strong but you needed proof
You saw her bathing on the roof
Her beauty and the moonlight overthrew ya
She tied you to a kitchen chair
She broke your throne, and she cut your hair
And from your lips she drew the hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
You say I took the name in vain
I don't even know the name
But if I did, well really, what's it to you?
There's a blaze of light in every word
It doesn't matter which you heard
The holy or the broken hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
I did my best, it wasn't much
I couldn't feel, so I tried to touch
I've told the truth, I didn't come to fool you
And even though it all went wrong
I'll stand before the lord of song
With nothing on my tongue but hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah
Hallelujah

		</textarea>
		<p id="debug"></p>
	</body>
</html>
<script>
	// Variables
	var scroll = false;
	var textarea = document.getElementById('textarea_id');
	var lineHeight = parseInt(window.getComputedStyle(textarea).getPropertyValue('line-height'), 10); // Line height in pixels
	var tstart, tend, count, bpm, tpb, tpl;

	
	// Keypress logic
	document.body.onkeyup = function(e){
		if(e.keyCode == 66){						// 'b' key takes in tempo
			if((new Date()).getTime()-tend > 2000 || !tstart){ // If first tap or over 2 seconds has ellapsed since last tempo tap, grab a new start time
				tstart= (new Date()).getTime();
				tend = tstart;
				scroll = false;
				count = 0;
			}
			else 
				tend = (new Date()).getTime();
			count++;
			tpb = (tend-tstart)/count;				// Calculate time per beat (ms)
			bpm = 60*1000/tpb;						// Calculate beats per minute
			tpl = tpb*4;							// Calculate beats per line
		}
		if(e.keyCode == 32){						// 'space' key toggles scrolling
			scroll = !scroll;
			if(scroll)
				run();
		}
	} 
	
	// Scrolling Function
	function run(){
		textarea.scrollTop += 1;
		if(scroll){
			window.setTimeout(run, tpl/lineHeight);	// Traverse one line per 'Time per line"
		}
	}
	
	// Debugging Info
	setInterval(function(){
		document.getElementById("debug").innerHTML = "\ncount: "+count+"\nscroll: "+scroll+"\nbpm: "+bpm + "\nmilliseconds per beat: "+tpb+"\nmilliseconds per line: "+tpl+"\nLine-Height: "+lineHeight+"px";
		if (scroll){
			//textarea.scrollTop += 1;
			var dif = Number(t2) - Number(t1);
			//textarea.value+=(t1-t2)+' '+count+'\n';
			//textarea.scrollTop = textarea.scrollHeight;
		}
	}, (10));
</script>